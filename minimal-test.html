<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minimal TRS-80 Test</title>
  <style>
    body {
      background: #a8b598;
      margin: 0;
      font-family: monospace;
      padding: 20px;
    }
    #test-container {
      border: 2px solid #1a3d1a;
      padding: 20px;
      background: #c8d4b8;
    }
    canvas {
      border: 1px solid red;
      display: block;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div id="test-container" tabindex="0">
    <h2>Minimal TRS-80 Test</h2>
    <p>Click here and type - you should see characters appear below:</p>
    <canvas id="test-canvas" width="400" height="100"></canvas>
    <p id="debug-output">Debug info will appear here...</p>
  </div>

  <script>
    console.log('=== MINIMAL TEST STARTING ===');
    
    let canvas, ctx;
    let debugOutput;
    let testText = '';
    
    // Simple 5x7 font for 'A'
    const FONT_A = [0b01110,0b10001,0b10001,0b11111,0b10001,0b10001,0b10001];
    const FONT_H = [0b10001,0b10001,0b10001,0b11111,0b10001,0b10001,0b10001];
    const FONT_I = [0b01110,0b00100,0b00100,0b00100,0b00100,0b00100,0b01110];
    const FONT_SPACE = [0,0,0,0,0,0,0];
    
    const FONTS = {
      'A': FONT_A,
      'H': FONT_H,
      'I': FONT_I,
      ' ': FONT_SPACE
    };
    
    function drawPixelChar(char, x, y) {
      const fontData = FONTS[char.toUpperCase()];
      if (!fontData) {
        console.log('No font data for:', char);
        return;
      }
      
      console.log('Drawing character:', char, 'at', x, y);
      
      ctx.fillStyle = '#1a3d1a';
      for (let row = 0; row < 7; row++) {
        for (let col = 0; col < 5; col++) {
          if (fontData[row] & (1 << (4 - col))) {
            ctx.fillRect(x + col * 4, y + row * 4, 4, 4);
          }
        }
      }
    }
    
    function renderText() {
      console.log('Rendering text:', testText);
      
      // Clear canvas
      ctx.fillStyle = '#c8d4b8';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw text
      let x = 10;
      for (let i = 0; i < testText.length; i++) {
        drawPixelChar(testText[i], x, 10);
        x += 24; // 6*4 pixels per char
      }
      
      // Update debug info
      debugOutput.textContent = `Text: "${testText}" (length: ${testText.length})`;
    }
    
    function addChar(char) {
      console.log('Adding character:', char);
      testText += char.toUpperCase();
      renderText();
    }
    
    function handleKey(e) {
      console.log('Key pressed:', e.key, 'Code:', e.code);
      
      if (e.key.length === 1) {
        addChar(e.key);
      } else if (e.key === 'Backspace') {
        testText = testText.slice(0, -1);
        renderText();
      } else if (e.key === ' ') {
        addChar(' ');
      }
      
      e.preventDefault();
    }
    
    // Initialize when DOM loads
    window.addEventListener('DOMContentLoaded', () => {
      console.log('DOM loaded, initializing...');
      
      canvas = document.getElementById('test-canvas');
      ctx = canvas.getContext('2d');
      debugOutput = document.getElementById('debug-output');
      
      if (!canvas || !ctx) {
        console.error('Canvas setup failed');
        return;
      }
      
      console.log('Canvas setup successful');
      
      // Initial render
      testText = 'HI';
      renderText();
      
      // Set up keyboard events
      const container = document.getElementById('test-container');
      container.addEventListener('keydown', handleKey);
      container.focus();
      
      console.log('Event listeners set up');
      console.log('=== MINIMAL TEST READY ===');
      console.log('Click the container and type A, H, I to test');
    });
  </script>
</body>
</html>