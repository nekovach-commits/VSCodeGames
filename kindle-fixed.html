<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRS-80 Model 100 - Kindle Compatible</title>
  <style>
    body {
      margin: 0;
      padding: 10px;
      background: #000;
      color: #00ff00;
      font-family: monospace;
      overflow: hidden;
      user-select: none;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      max-width: 100%;
    }

    .screen-container {
      background: #222;
      padding: 10px;
      border: 3px solid #666;
      border-radius: 5px;
      margin-bottom: 20px;
    }

    #retro-canvas {
      display: block;
      background: #000;
      border: 2px solid #333;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      max-width: 100%;
      height: auto;
    }

    .keyboard {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 5px;
      max-width: 800px;
      width: 100%;
    }

    .trs80-key {
      background: #333;
      color: #fff;
      border: 2px solid #666;
      border-radius: 4px;
      padding: 15px 5px;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .trs80-key:hover, .trs80-key:active {
      background: #555;
      border-color: #888;
    }

    .trs80-key.space-key {
      grid-column: span 4;
    }

    .status {
      color: #0f0;
      margin: 10px 0;
      font-size: 14px;
      text-align: center;
    }

    /* Kindle ColorSoft optimizations */
    @media (max-width: 900px) {
      .trs80-key {
        padding: 12px 3px;
        font-size: 11px;
        min-height: 35px;
      }
      
      .keyboard {
        gap: 3px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="status" id="status">
      TRS-80 Model 100 Emulator - Initializing...
    </div>
    
    <div class="screen-container">
      <canvas id="retro-canvas" width="800" height="300"></canvas>
    </div>

    <div class="keyboard">
      <!-- Row 1 -->
      <button class="trs80-key" data-key="1">1</button>
      <button class="trs80-key" data-key="2">2</button>
      <button class="trs80-key" data-key="3">3</button>
      <button class="trs80-key" data-key="4">4</button>
      <button class="trs80-key" data-key="5">5</button>
      <button class="trs80-key" data-key="6">6</button>
      <button class="trs80-key" data-key="7">7</button>
      <button class="trs80-key" data-key="8">8</button>
      <button class="trs80-key" data-key="9">9</button>
      <button class="trs80-key" data-key="0">0</button>

      <!-- Row 2 -->
      <button class="trs80-key" data-key="Q">Q</button>
      <button class="trs80-key" data-key="W">W</button>
      <button class="trs80-key" data-key="E">E</button>
      <button class="trs80-key" data-key="R">R</button>
      <button class="trs80-key" data-key="T">T</button>
      <button class="trs80-key" data-key="Y">Y</button>
      <button class="trs80-key" data-key="U">U</button>
      <button class="trs80-key" data-key="I">I</button>
      <button class="trs80-key" data-key="O">O</button>
      <button class="trs80-key" data-key="P">P</button>

      <!-- Row 3 -->
      <button class="trs80-key" data-key="A">A</button>
      <button class="trs80-key" data-key="S">S</button>
      <button class="trs80-key" data-key="D">D</button>
      <button class="trs80-key" data-key="F">F</button>
      <button class="trs80-key" data-key="G">G</button>
      <button class="trs80-key" data-key="H">H</button>
      <button class="trs80-key" data-key="J">J</button>
      <button class="trs80-key" data-key="K">K</button>
      <button class="trs80-key" data-key="L">L</button>
      <button class="trs80-key" data-key="Enter">ENTER</button>

      <!-- Row 4 -->
      <button class="trs80-key" data-key="Z">Z</button>
      <button class="trs80-key" data-key="X">X</button>
      <button class="trs80-key" data-key="C">C</button>
      <button class="trs80-key" data-key="V">V</button>
      <button class="trs80-key" data-key="B">B</button>
      <button class="trs80-key" data-key="N">N</button>
      <button class="trs80-key" data-key="M">M</button>
      <button class="trs80-key" data-key=",">,</button>
      <button class="trs80-key" data-key=".">.</button>
      <button class="trs80-key" data-key="Backspace">âŒ«</button>

      <!-- Row 5 -->
      <button class="trs80-key" data-key="!">[</button>
      <button class="trs80-key" data-key="@">]</button>
      <button class="trs80-key" data-key="+">=</button>
      <button class="trs80-key space-key" data-key=" ">SPACE</button>
      <button class="trs80-key" data-key="-">-</button>
      <button class="trs80-key" data-key="*">*</button>
      <button class="trs80-key" data-key="/">/</button>
      <button class="trs80-key" data-key="Escape">ESC</button>
    </div>
  </div>

  <script>
    // TRS-80 Model 100 5x7 Font Data
    const FONT_DATA = {
      ' ': [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
      '!': [0x04, 0x04, 0x04, 0x04, 0x00, 0x04, 0x00],
      '"': [0x0A, 0x0A, 0x0A, 0x00, 0x00, 0x00, 0x00],
      '#': [0x0A, 0x0A, 0x1F, 0x0A, 0x1F, 0x0A, 0x0A],
      '$': [0x04, 0x0F, 0x14, 0x0E, 0x05, 0x1E, 0x04],
      '%': [0x18, 0x19, 0x02, 0x04, 0x08, 0x13, 0x03],
      '&': [0x0C, 0x12, 0x14, 0x08, 0x15, 0x12, 0x0D],
      '\'': [0x0C, 0x04, 0x08, 0x00, 0x00, 0x00, 0x00],
      '(': [0x02, 0x04, 0x08, 0x08, 0x08, 0x04, 0x02],
      ')': [0x08, 0x04, 0x02, 0x02, 0x02, 0x04, 0x08],
      '*': [0x00, 0x04, 0x15, 0x0E, 0x15, 0x04, 0x00],
      '+': [0x00, 0x04, 0x04, 0x1F, 0x04, 0x04, 0x00],
      ',': [0x00, 0x00, 0x00, 0x00, 0x0C, 0x04, 0x08],
      '-': [0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00],
      '.': [0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x0C],
      '/': [0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x00],
      '0': [0x0E, 0x11, 0x13, 0x15, 0x19, 0x11, 0x0E],
      '1': [0x04, 0x0C, 0x04, 0x04, 0x04, 0x04, 0x0E],
      '2': [0x0E, 0x11, 0x01, 0x02, 0x04, 0x08, 0x1F],
      '3': [0x1F, 0x02, 0x04, 0x02, 0x01, 0x11, 0x0E],
      '4': [0x02, 0x06, 0x0A, 0x12, 0x1F, 0x02, 0x02],
      '5': [0x1F, 0x10, 0x1E, 0x01, 0x01, 0x11, 0x0E],
      '6': [0x06, 0x08, 0x10, 0x1E, 0x11, 0x11, 0x0E],
      '7': [0x1F, 0x01, 0x02, 0x04, 0x08, 0x08, 0x08],
      '8': [0x0E, 0x11, 0x11, 0x0E, 0x11, 0x11, 0x0E],
      '9': [0x0E, 0x11, 0x11, 0x0F, 0x01, 0x02, 0x0C],
      ':': [0x00, 0x0C, 0x0C, 0x00, 0x0C, 0x0C, 0x00],
      ';': [0x00, 0x0C, 0x0C, 0x00, 0x0C, 0x04, 0x08],
      '<': [0x02, 0x04, 0x08, 0x10, 0x08, 0x04, 0x02],
      '=': [0x00, 0x00, 0x1F, 0x00, 0x1F, 0x00, 0x00],
      '>': [0x08, 0x04, 0x02, 0x01, 0x02, 0x04, 0x08],
      '?': [0x0E, 0x11, 0x01, 0x02, 0x04, 0x00, 0x04],
      '@': [0x0E, 0x11, 0x01, 0x0D, 0x15, 0x15, 0x0E],
      'A': [0x0E, 0x11, 0x11, 0x11, 0x1F, 0x11, 0x11],
      'B': [0x1E, 0x11, 0x11, 0x1E, 0x11, 0x11, 0x1E],
      'C': [0x0E, 0x11, 0x10, 0x10, 0x10, 0x11, 0x0E],
      'D': [0x1C, 0x12, 0x11, 0x11, 0x11, 0x12, 0x1C],
      'E': [0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x1F],
      'F': [0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x10],
      'G': [0x0E, 0x11, 0x10, 0x17, 0x11, 0x11, 0x0F],
      'H': [0x11, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11],
      'I': [0x0E, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0E],
      'J': [0x07, 0x02, 0x02, 0x02, 0x02, 0x12, 0x0C],
      'K': [0x11, 0x12, 0x14, 0x18, 0x14, 0x12, 0x11],
      'L': [0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1F],
      'M': [0x11, 0x1B, 0x15, 0x15, 0x11, 0x11, 0x11],
      'N': [0x11, 0x11, 0x19, 0x15, 0x13, 0x11, 0x11],
      'O': [0x0E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E],
      'P': [0x1E, 0x11, 0x11, 0x1E, 0x10, 0x10, 0x10],
      'Q': [0x0E, 0x11, 0x11, 0x15, 0x13, 0x11, 0x0F],
      'R': [0x1E, 0x11, 0x11, 0x1E, 0x14, 0x12, 0x11],
      'S': [0x0F, 0x10, 0x10, 0x0E, 0x01, 0x01, 0x1E],
      'T': [0x1F, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04],
      'U': [0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E],
      'V': [0x11, 0x11, 0x11, 0x11, 0x11, 0x0A, 0x04],
      'W': [0x11, 0x11, 0x11, 0x15, 0x15, 0x1B, 0x11],
      'X': [0x11, 0x11, 0x0A, 0x04, 0x0A, 0x11, 0x11],
      'Y': [0x11, 0x11, 0x11, 0x0A, 0x04, 0x04, 0x04],
      'Z': [0x1F, 0x01, 0x02, 0x04, 0x08, 0x10, 0x1F],
      '[': [0x0E, 0x08, 0x08, 0x08, 0x08, 0x08, 0x0E],
      '\\': [0x00, 0x10, 0x08, 0x04, 0x02, 0x01, 0x00],
      ']': [0x0E, 0x02, 0x02, 0x02, 0x02, 0x02, 0x0E],
      '^': [0x04, 0x0A, 0x11, 0x00, 0x00, 0x00, 0x00],
      '_': [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F],
      '`': [0x08, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00],
      'a': [0x00, 0x00, 0x0E, 0x01, 0x0F, 0x11, 0x0F],
      'b': [0x10, 0x10, 0x16, 0x19, 0x11, 0x11, 0x1E],
      'c': [0x00, 0x00, 0x0E, 0x10, 0x10, 0x11, 0x0E],
      'd': [0x01, 0x01, 0x0D, 0x13, 0x11, 0x11, 0x0F],
      'e': [0x00, 0x00, 0x0E, 0x11, 0x1F, 0x10, 0x0E],
      'f': [0x06, 0x09, 0x08, 0x1C, 0x08, 0x08, 0x08],
      'g': [0x00, 0x00, 0x0F, 0x11, 0x0F, 0x01, 0x0E],
      'h': [0x10, 0x10, 0x16, 0x19, 0x11, 0x11, 0x11],
      'i': [0x04, 0x00, 0x0C, 0x04, 0x04, 0x04, 0x0E],
      'j': [0x02, 0x00, 0x06, 0x02, 0x02, 0x12, 0x0C],
      'k': [0x10, 0x10, 0x12, 0x14, 0x18, 0x14, 0x12],
      'l': [0x0C, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0E],
      'm': [0x00, 0x00, 0x1A, 0x15, 0x15, 0x11, 0x11],
      'n': [0x00, 0x00, 0x16, 0x19, 0x11, 0x11, 0x11],
      'o': [0x00, 0x00, 0x0E, 0x11, 0x11, 0x11, 0x0E],
      'p': [0x00, 0x00, 0x1E, 0x11, 0x1E, 0x10, 0x10],
      'q': [0x00, 0x00, 0x0D, 0x13, 0x0F, 0x01, 0x01],
      'r': [0x00, 0x00, 0x16, 0x19, 0x10, 0x10, 0x10],
      's': [0x00, 0x00, 0x0E, 0x10, 0x0E, 0x01, 0x1E],
      't': [0x08, 0x08, 0x1C, 0x08, 0x08, 0x09, 0x06],
      'u': [0x00, 0x00, 0x11, 0x11, 0x11, 0x13, 0x0D],
      'v': [0x00, 0x00, 0x11, 0x11, 0x11, 0x0A, 0x04],
      'w': [0x00, 0x00, 0x11, 0x11, 0x15, 0x15, 0x0A],
      'x': [0x00, 0x00, 0x11, 0x0A, 0x04, 0x0A, 0x11],
      'y': [0x00, 0x00, 0x11, 0x11, 0x0F, 0x01, 0x0E],
      'z': [0x00, 0x00, 0x1F, 0x02, 0x04, 0x08, 0x1F],
      '{': [0x02, 0x04, 0x04, 0x08, 0x04, 0x04, 0x02],
      '|': [0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04],
      '}': [0x08, 0x04, 0x04, 0x02, 0x04, 0x04, 0x08],
      '~': [0x00, 0x00, 0x00, 0x0C, 0x12, 0x06, 0x00]
    };

    // TRS-80 Model 100 Configuration
    const TRS80_CONFIG = {
      SCREEN_WIDTH: 40,
      SCREEN_HEIGHT: 10,
      BUFFER_SIZE: 100,
      FONT_WIDTH: 5,
      FONT_HEIGHT: 7,
      PIXEL_SIZE: 4,
      CHAR_SPACING: 2,
      LINE_SPACING: 4,
      CANVAS_WIDTH: 800,
      CANVAS_HEIGHT: 300
    };

    // Draw character using pixel-perfect 5x7 font
    function drawChar(ctx, char, x, y, pixelSize, color) {
      const fontData = FONT_DATA[char];
      if (!fontData) return;
      
      ctx.fillStyle = color;
      
      for (let row = 0; row < 7; row++) {
        const rowData = fontData[row];
        for (let col = 0; col < 5; col++) {
          if (rowData & (1 << (4 - col))) {
            const pixelX = x + col * pixelSize;
            const pixelY = y + row * pixelSize;
            ctx.fillRect(pixelX, pixelY, pixelSize, pixelSize);
          }
        }
      }
    }

    // TRS-80 Model 100 Display System
    class TRS80Display {
      constructor(canvas) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        
        // Set canvas dimensions
        this.canvas.width = TRS80_CONFIG.CANVAS_WIDTH;
        this.canvas.height = TRS80_CONFIG.CANVAS_HEIGHT;
        
        // Display state
        this.cursorRow = 0;
        this.cursorCol = 0;
        this.scrollOffset = 0;
        this.textBuffer = [];
        this.cursorVisible = true;
        this.lastBlinkTime = Date.now();
        
        // Initialize text buffer
        this.initializeBuffer();
        
        // Style the canvas
        this.canvas.style.backgroundColor = '#000';
        this.canvas.style.border = '2px solid #333';
        this.canvas.style.imageRendering = 'pixelated';
        this.canvas.style.imageRendering = 'crisp-edges';
        
        this.render();
        this.startCursorBlink();
        
        console.log('TRS-80 Display initialized with pixel-perfect rendering');
      }
      
      initializeBuffer() {
        for (let i = 0; i < TRS80_CONFIG.BUFFER_SIZE; i++) {
          this.textBuffer[i] = new Array(TRS80_CONFIG.SCREEN_WIDTH).fill(' ');
        }
      }
      
      addChar(char) {
        if (char === '\n') {
          this.cursorRow++;
          this.cursorCol = 0;
          if (this.cursorRow >= TRS80_CONFIG.BUFFER_SIZE) {
            this.cursorRow = TRS80_CONFIG.BUFFER_SIZE - 1;
            this.scrollUp();
          }
        } else if (char === '\b' || char === 'Backspace') {
          if (this.cursorCol > 0) {
            this.cursorCol--;
            this.textBuffer[this.cursorRow][this.cursorCol] = ' ';
          } else if (this.cursorRow > 0) {
            this.cursorRow--;
            this.cursorCol = TRS80_CONFIG.SCREEN_WIDTH - 1;
            this.textBuffer[this.cursorRow][this.cursorCol] = ' ';
          }
        } else if (char === 'Escape') {
          // Clear screen
          this.clear();
        } else if (char === 'Enter') {
          this.addChar('\n');
          return;
        } else if (char === 'ArrowUp' && this.cursorRow > 0) {
          this.cursorRow--;
        } else if (char === 'ArrowDown' && this.cursorRow < TRS80_CONFIG.BUFFER_SIZE - 1) {
          this.cursorRow++;
        } else if (char === 'ArrowLeft' && this.cursorCol > 0) {
          this.cursorCol--;
        } else if (char === 'ArrowRight' && this.cursorCol < TRS80_CONFIG.SCREEN_WIDTH - 1) {
          this.cursorCol++;
        } else if (char === 'Tab') {
          // Add 4 spaces
          for (let i = 0; i < 4 && this.cursorCol < TRS80_CONFIG.SCREEN_WIDTH; i++) {
            this.textBuffer[this.cursorRow][this.cursorCol] = ' ';
            this.cursorCol++;
          }
          if (this.cursorCol >= TRS80_CONFIG.SCREEN_WIDTH) {
            this.cursorCol = 0;
            this.cursorRow++;
            if (this.cursorRow >= TRS80_CONFIG.BUFFER_SIZE) {
              this.cursorRow = TRS80_CONFIG.BUFFER_SIZE - 1;
              this.scrollUp();
            }
          }
        } else if (char && char.length === 1) {
          // Regular character
          this.textBuffer[this.cursorRow][this.cursorCol] = char;
          this.cursorCol++;
          if (this.cursorCol >= TRS80_CONFIG.SCREEN_WIDTH) {
            this.cursorCol = 0;
            this.cursorRow++;
            if (this.cursorRow >= TRS80_CONFIG.BUFFER_SIZE) {
              this.cursorRow = TRS80_CONFIG.BUFFER_SIZE - 1;
              this.scrollUp();
            }
          }
        }
        this.render();
      }
      
      scrollUp() {
        for (let i = 0; i < TRS80_CONFIG.BUFFER_SIZE - 1; i++) {
          this.textBuffer[i] = [...this.textBuffer[i + 1]];
        }
        this.textBuffer[TRS80_CONFIG.BUFFER_SIZE - 1] = new Array(TRS80_CONFIG.SCREEN_WIDTH).fill(' ');
      }
      
      render() {
        // Clear screen with black background
        this.ctx.fillStyle = '#000';
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
        
        const charWidth = TRS80_CONFIG.FONT_WIDTH * TRS80_CONFIG.PIXEL_SIZE + TRS80_CONFIG.CHAR_SPACING;
        const lineHeight = TRS80_CONFIG.FONT_HEIGHT * TRS80_CONFIG.PIXEL_SIZE + TRS80_CONFIG.LINE_SPACING;
        
        // Calculate visible area
        const startRow = Math.max(0, this.scrollOffset);
        const endRow = Math.min(TRS80_CONFIG.BUFFER_SIZE, startRow + TRS80_CONFIG.SCREEN_HEIGHT);
        
        // Render visible characters using pixel-perfect font
        for (let bufferRow = startRow; bufferRow < endRow; bufferRow++) {
          const screenRow = bufferRow - startRow;
          const y = screenRow * lineHeight + 10;
          
          for (let col = 0; col < TRS80_CONFIG.SCREEN_WIDTH; col++) {
            const char = this.textBuffer[bufferRow][col];
            if (char && char !== ' ') {
              const x = col * charWidth + 10;
              drawChar(this.ctx, char, x, y, TRS80_CONFIG.PIXEL_SIZE, '#00ff00');
            }
          }
        }
        
        // Draw cursor
        if (this.cursorVisible) {
          const cursorScreenRow = this.cursorRow - this.scrollOffset;
          if (cursorScreenRow >= 0 && cursorScreenRow < TRS80_CONFIG.SCREEN_HEIGHT) {
            const cursorX = this.cursorCol * charWidth + 10;
            const cursorY = cursorScreenRow * lineHeight + 10 + (TRS80_CONFIG.FONT_HEIGHT * TRS80_CONFIG.PIXEL_SIZE);
            
            this.ctx.fillStyle = '#00ff00';
            this.ctx.fillRect(cursorX, cursorY, charWidth - TRS80_CONFIG.CHAR_SPACING, 2);
          }
        }
      }
      
      startCursorBlink() {
        setInterval(() => {
          this.cursorVisible = !this.cursorVisible;
          this.render();
        }, 500);
      }
      
      clear() {
        this.cursorRow = 0;
        this.cursorCol = 0;
        this.scrollOffset = 0;
        this.initializeBuffer();
        this.render();
      }
    }

    // Initialize system
    console.log('ðŸ”„ Initializing TRS-80 Model 100 - Kindle Compatible Version');
    
    const canvas = document.getElementById('retro-canvas');
    const trs80 = new TRS80Display(canvas);
    
    // Update status
    document.getElementById('status').textContent = 'TRS-80 Model 100 Ready - Pixel Perfect Mode';
    
    // Set up keyboard event handling
    document.addEventListener('keydown', function(e) {
      console.log('Key pressed:', e.key);
      trs80.addChar(e.key);
      e.preventDefault();
    });
    
    // Set up on-screen keyboard
    const keyButtons = document.querySelectorAll('.trs80-key');
    keyButtons.forEach(button => {
      const keyValue = button.getAttribute('data-key');
      
      button.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('On-screen key clicked:', keyValue);
        trs80.addChar(keyValue);
      });
      
      button.addEventListener('touchend', function(e) {
        e.preventDefault();
        console.log('Touch key:', keyValue);
        trs80.addChar(keyValue);
      });
    });
    
    // Add welcome message
    setTimeout(() => {
      const welcomeMessage = 'TRS-80 MODEL 100 READY';
      for (let i = 0; i < welcomeMessage.length; i++) {
        trs80.addChar(welcomeMessage[i]);
      }
      trs80.addChar('\n');
      trs80.addChar('\n');
      trs80.addChar('>');
    }, 500);
    
    console.log('âœ… TRS-80 Model 100 Kindle Compatible initialized successfully');
  </script>
</body>
</html>