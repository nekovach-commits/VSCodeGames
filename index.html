<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRS-80 Model 100 Emulator</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="css/trs80-keyboard.css">
</head>
<body>
  <div id="retro-container" tabindex="0">
    <canvas id="retro-canvas"></canvas>
    
    <div id="keyboard-area">
      <!-- TRS-80 Model 100 On-Screen Keyboard -->
      <div id="trs80-keyboard-container" class="trs80-keyboard" style="display: none;">
        <div class="keyboard-info">
          <span class="keyboard-title">TRS-80 MODEL 100 KEYBOARD</span>
          <span class="keyboard-instructions">Tap keys to type ‚Ä¢ Arrow keys navigate ‚Ä¢ ESC clears screen</span>
        </div>
        
        <!-- Function Keys Row -->
        <div class="keyboard-section function-section">
          <div class="keyboard-row function-row">
            <button class="trs80-key function-key" data-key="F1">F1</button>
            <button class="trs80-key function-key" data-key="F2">F2</button>
            <button class="trs80-key function-key" data-key="F3">F3</button>
            <button class="trs80-key function-key" data-key="F4">F4</button>
            <button class="trs80-key function-key" data-key="F5">F5</button>
            <button class="trs80-key function-key" data-key="F6">F6</button>
            <button class="trs80-key function-key" data-key="F7">F7</button>
            <button class="trs80-key function-key" data-key="F8">F8</button>
          </div>
        </div>
        
        <!-- Main Keyboard Section -->
        <div class="keyboard-section main-section">
          <!-- Number Row -->
          <div class="keyboard-row number-row">
            <button class="trs80-key" data-key="1">1<span class="key-symbol">!</span></button>
            <button class="trs80-key" data-key="2">2<span class="key-symbol">@</span></button>
            <button class="trs80-key" data-key="3">3<span class="key-symbol">#</span></button>
            <button class="trs80-key" data-key="4">4<span class="key-symbol">$</span></button>
            <button class="trs80-key" data-key="5">5<span class="key-symbol">%</span></button>
            <button class="trs80-key" data-key="6">6<span class="key-symbol">^</span></button>
            <button class="trs80-key" data-key="7">7<span class="key-symbol">&</span></button>
            <button class="trs80-key" data-key="8">8<span class="key-symbol">*</span></button>
            <button class="trs80-key" data-key="9">9<span class="key-symbol">(</span></button>
            <button class="trs80-key" data-key="0">0<span class="key-symbol">)</span></button>
            <button class="trs80-key" data-key="-">-<span class="key-symbol">_</span></button>
            <button class="trs80-key" data-key="=">=<span class="key-symbol">+</span></button>
            <button class="trs80-key backspace-key" data-key="Backspace">BACKSPACE</button>
          </div>
          
          <!-- QWERTY Top Row -->
          <div class="keyboard-row qwerty-row">
            <button class="trs80-key tab-key" data-key="Tab">TAB</button>
            <button class="trs80-key" data-key="q">Q</button>
            <button class="trs80-key" data-key="w">W</button>
            <button class="trs80-key" data-key="e">E</button>
            <button class="trs80-key" data-key="r">R</button>
            <button class="trs80-key" data-key="t">T</button>
            <button class="trs80-key" data-key="y">Y</button>
            <button class="trs80-key" data-key="u">U</button>
            <button class="trs80-key" data-key="i">I</button>
            <button class="trs80-key" data-key="o">O</button>
            <button class="trs80-key" data-key="p">P</button>
            <button class="trs80-key" data-key="[">[<span class="key-symbol">{</span></button>
            <button class="trs80-key" data-key="]">]<span class="key-symbol">}</span></button>
          </div>
          
          <!-- QWERTY Middle Row -->
          <div class="keyboard-row qwerty-row">
            <button class="trs80-key caps-key" data-key="CapsLock">CAPS</button>
            <button class="trs80-key" data-key="a">A</button>
            <button class="trs80-key" data-key="s">S</button>
            <button class="trs80-key" data-key="d">D</button>
            <button class="trs80-key" data-key="f">F</button>
            <button class="trs80-key" data-key="g">G</button>
            <button class="trs80-key" data-key="h">H</button>
            <button class="trs80-key" data-key="j">J</button>
            <button class="trs80-key" data-key="k">K</button>
            <button class="trs80-key" data-key="l">L</button>
            <button class="trs80-key" data-key=";">;<span class="key-symbol">:</span></button>
            <button class="trs80-key" data-key="'">'<span class="key-symbol">"</span></button>
            <button class="trs80-key enter-key" data-key="Enter">ENTER</button>
          </div>
          
          <!-- QWERTY Bottom Row -->
          <div class="keyboard-row qwerty-row">
            <button class="trs80-key shift-key" data-key="Shift">SHIFT</button>
            <button class="trs80-key" data-key="z">Z</button>
            <button class="trs80-key" data-key="x">X</button>
            <button class="trs80-key" data-key="c">C</button>
            <button class="trs80-key" data-key="v">V</button>
            <button class="trs80-key" data-key="b">B</button>
            <button class="trs80-key" data-key="n">N</button>
            <button class="trs80-key" data-key="m">M</button>
            <button class="trs80-key" data-key=",">,<span class="key-symbol">&lt;</span></button>
            <button class="trs80-key" data-key=".">.<span class="key-symbol">&gt;</span></button>
            <button class="trs80-key" data-key="/">/<span class="key-symbol">?</span></button>
            <button class="trs80-key shift-key" data-key="Shift">SHIFT</button>
          </div>
          
          <!-- Control Row -->
          <div class="keyboard-row control-row">
            <button class="trs80-key ctrl-key" data-key="Control">CTRL</button>
            <button class="trs80-key space-key" data-key=" ">SPACE</button>
            <button class="trs80-key esc-key" data-key="Escape">ESC</button>
          </div>
        </div>
        
        <!-- Arrow Keys Section -->
        <div class="keyboard-section arrow-section">
          <div class="arrow-cluster">
            <div class="arrow-row">
              <button class="trs80-key arrow-key" data-key="ArrowUp">‚Üë</button>
            </div>
            <div class="arrow-row">
              <button class="trs80-key arrow-key" data-key="ArrowLeft">‚Üê</button>
              <button class="trs80-key arrow-key" data-key="ArrowDown">‚Üì</button>
              <button class="trs80-key arrow-key" data-key="ArrowRight">‚Üí</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Desktop Info -->
      <div id="desktop-info" style="margin-top: 15px;">
        <p><strong>TRS-80 MODEL 100 - PORTABLE COMPUTER</strong></p>
        <p>Type anything ‚Ä¢ ENTER: new line ‚Ä¢ ESC: clear ‚Ä¢ BACKSPACE: delete ‚Ä¢ Arrow keys: navigate</p>
        <p>Resolution: <span id="resolution-info">Loading...</span></p>
        <button id="keyboard-toggle" onclick="toggleKeyboard()" style="margin-top: 10px; padding: 8px 16px; background: linear-gradient(145deg, #f0f0f0, #e0e0e0); border: 2px outset #f0f0f0; border-radius: 4px; cursor: pointer; font-family: 'Courier New', monospace; font-size: 12px;">
          üì± Show Keyboard
        </button>
        <div id="debug-info" style="margin-top: 10px; font-size: 10px; color: #666;"></div>
      </div>
    </div>
  </div>

  <!-- Immediate resolution and device detection script -->
  <script>
    function updateResolutionInfo() {
      const resolutionInfo = document.getElementById('resolution-info');
      const debugInfo = document.getElementById('debug-info');
      
      if (resolutionInfo) {
        const info = [
          `${window.innerWidth}√ó${window.innerHeight}`,
          `Screen: ${screen.width}√ó${screen.height}`,
          `DPR: ${window.devicePixelRatio || 1}`,
          `Touch: ${'ontouchstart' in window ? 'Yes' : 'No'}`
        ].join(' ‚Ä¢ ');
        resolutionInfo.textContent = info;
      }
      
      if (debugInfo) {
        const ua = navigator.userAgent;
        const isMobile = /Mobi|Android|iPhone|iPad|Kindle|Silk|ColorSoft/i.test(ua);
        const hasTouch = 'ontouchstart' in window;
        const isKindle = ua.toLowerCase().includes('kindle') || ua.toLowerCase().includes('silk');
        
        debugInfo.innerHTML = `
          <strong>Debug Info:</strong><br>
          User Agent: ${ua.substring(0, 100)}...<br>
          Mobile Detected: ${isMobile}<br>
          Touch Support: ${hasTouch}<br>
          Kindle Detected: ${isKindle}<br>
          Window Size: ${window.innerWidth} √ó ${window.innerHeight}<br>
        `;
      }
    }
    
    function toggleKeyboard() {
      const keyboard = document.getElementById('trs80-keyboard-container');
      const button = document.getElementById('keyboard-toggle');
      
      if (keyboard) {
        const isVisible = keyboard.style.display !== 'none';
        keyboard.style.display = isVisible ? 'none' : 'block';
        button.textContent = isVisible ? 'üì± Show Keyboard' : 'üì± Hide Keyboard';
        
        console.log('Keyboard toggled:', !isVisible ? 'shown' : 'hidden');
      }
    }
    
    function showKeyboardBasedOnDevice() {
      const ua = navigator.userAgent.toLowerCase();
      const isMobile = /mobi|android|iphone|ipad|kindle|silk|colorsoft/i.test(navigator.userAgent) || 
                       window.innerWidth < 900 || 
                       'ontouchstart' in window;
      
      const keyboard = document.getElementById('trs80-keyboard-container');
      const desktopInfo = document.getElementById('desktop-info');
      
      console.log('=== DEVICE DETECTION ===');
      console.log('User Agent:', navigator.userAgent);
      console.log('Is Mobile:', isMobile);
      console.log('Window size:', window.innerWidth, '√ó', window.innerHeight);
      
      if (keyboard && desktopInfo) {
        if (isMobile) {
          keyboard.style.display = 'block';
          desktopInfo.style.display = 'none';
          console.log('‚úÖ Showing keyboard for mobile device');
        } else {
          keyboard.style.display = 'none';
          desktopInfo.style.display = 'block';
          console.log('‚ùå Hiding keyboard for desktop');
        }
      }
    }
    
    // Update resolution immediately
    updateResolutionInfo();
    
    // Update on resize
    window.addEventListener('resize', updateResolutionInfo);
    
    // Show keyboard based on device detection
    document.addEventListener('DOMContentLoaded', function() {
      showKeyboardBasedOnDevice();
      updateResolutionInfo();
    });
    
    // Also run immediately in case DOMContentLoaded already fired
    if (document.readyState === 'loading') {
      // Do nothing, DOMContentLoaded will fire
    } else {
      showKeyboardBasedOnDevice();
    }
  </script>

  <script type="module" src="js/trs80-main.js"></script>
  
  <!-- Fallback script if modules don't load -->
  <script>
    // Simple fallback TRS-80 system if modules fail to load
    setTimeout(function() {
      if (!window.trs80) {
        console.log('‚ö†Ô∏è  Module system failed to load, using fallback');
        
        // Basic canvas setup
        const canvas = document.getElementById('retro-canvas');
        if (canvas) {
          canvas.width = 1000;
          canvas.height = 360;
          const ctx = canvas.getContext('2d');
          
          // Draw basic screen
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = '#000000';
          ctx.fillRect(0, 0, canvas.width, 20);
          ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
          ctx.fillRect(0, 0, 20, canvas.height);
          ctx.fillRect(canvas.width - 20, 0, 20, canvas.height);
          
          // Add welcome message
          ctx.fillStyle = '#000000';
          ctx.font = '16px Courier New';
          ctx.fillText('TRS-80 Model 100 Ready', 50, 200);
          ctx.fillText('Module loading failed - using fallback', 50, 230);
          ctx.fillText('Use manual keyboard toggle button below', 50, 260);
        }
      }
    }, 2000);
  </script>
</body>
</html>
