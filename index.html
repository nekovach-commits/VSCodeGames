<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="cache-bust" content="v2025-11-06-1">
  <title>TRS-80 Model 100 Emulator - Updated 2025-11-06</title>
  <link rel="stylesheet" href="style.css">
</head>
<body style="background: #ffffff !important; color: #000000 !important;">
  <div id="retro-container" tabindex="0" style="background: #ffffff !important;">
    <canvas id="retro-canvas" style="background: #ffffff !important; border: 1px solid #000000 !important; cursor: text;"></canvas>
    
    <input type="text" id="kindle-input" placeholder="Tap here to open Kindle keyboard and type..." 
           style="width: 100%; max-width: 500px; padding: 10px; margin: 10px 0; font-family: 'Courier New', monospace; font-size: 16px; border: 2px solid #000; border-radius: 3px;">
    
    <div style="font-size: 12px; color: #666; margin-top: 10px; text-align: center;">
      üí° <strong>Kindle Users:</strong> Type in the input box above - text will appear on TRS-80 screen<br>
      üñ•Ô∏è <strong>E-ink Optimized:</strong> High contrast black/white display for better readability<br>
      üìù <strong>BASIC Commands:</strong> PRINT "HELLO", CLS, LIST, COLOR 1, LET A=5<br>
      ‚ö° <strong>Canvas Mode:</strong> Optimized for e-ink displays with crisp pixel rendering<br>
      <span id="status-msg" style="color: #006600;">System Status: Loading...</span>
    </div>
    
    <script>
      // Simple device detection for canvas sizing
      function getPixelSize() {
        const w = window.screen.width;
        const h = window.screen.height;
        
        // Kindle devices - conservative sizing
        if (w === 636 && h === 848) return 2; // Kindle ColorSoft
        if (w === 930 && h === 1240) return 3; // Kindle Scribe
        
        // General categories
        if (w <= 768) return 1;   // Mobile
        if (w <= 1024) return 2; // Tablet
        return 4; // Desktop - proper retro scaling
      }
      
      // Set canvas size immediately
      const canvas = document.getElementById('retro-canvas');
      const pixelSize = getPixelSize();
      const charArea = { width: 40 * 6 * pixelSize, height: 20 * 8 * pixelSize };
      const border = 10;
      canvas.width = charArea.width + (border * 2);
      canvas.height = charArea.height + (border * 2);
      
      console.log('Canvas sized:', canvas.width + 'x' + canvas.height, 'for pixel scale', pixelSize);
    </script>
    
    <div id="keyboard-area" style="background: #ffffff !important; color: #000000 !important;">
      <!-- Desktop Info -->
      <div id="desktop-info" style="margin-top: 15px; color: #000000 !important;">
  <p><strong>TRS-80 MODEL 100 - PORTABLE COMPUTER (KINDLE DISPLAY FIXED - Nov 2, 2025 - GitHub Updated)</strong></p>
        <p>Type anything ‚Ä¢ ENTER: new line ‚Ä¢ ESC: clear ‚Ä¢ BACKSPACE: delete ‚Ä¢ Arrow keys: navigate</p>
        <p>Resolution: <span id="resolution-info">Loading...</span></p>
        <div id="debug-info" style="margin-top: 10px; font-size: 10px; color: #666; font-family: monospace;">
          <div>Screen Resolution: <span id="screen-res">Loading...</span></div>
          <div>Canvas Size: <span id="canvas-size">Loading...</span></div>
          <div>Expected Size: <span id="expected-size">Loading...</span></div>
          <div>Device Type: <span id="device-type">Loading...</span></div>
          <div>Scale Factor: <span id="scale-factor">Loading...</span></div>
          <div>Pixel Scale: <span id="pixel-scale">Loading...</span></div>
          <div>System Version: <span id="system-version">Detecting...</span></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========================================
    // RESOLUTION & DEVICE INFO FUNCTIONS
    // ========================================
    
    function updateResolutionInfo() {
      const resolutionInfo = document.getElementById('resolution-info');
      
      if (resolutionInfo) {
        const info = [
          `${window.innerWidth}√ó${window.innerHeight}`,
          `Screen: ${screen.width}√ó${screen.height}`,
          `DPR: ${window.devicePixelRatio || 1}`,
          `Touch: ${'ontouchstart' in window ? 'Yes' : 'No'}`
        ].join(' ‚Ä¢ ');
        resolutionInfo.textContent = info;
      }
      
      // Update individual debug fields
      const canvas = document.getElementById('retro-canvas');
      if (canvas) {
        const computedStyle = window.getComputedStyle(canvas);
        
        // Screen Resolution
        const screenRes = document.getElementById('screen-res');
        if (screenRes) screenRes.textContent = `${screen.width}√ó${screen.height}`;
        
        // Canvas Size
        const canvasSize = document.getElementById('canvas-size');
        if (canvasSize) canvasSize.textContent = `${canvas.width}√ó${canvas.height}`;
        
        // Expected Size
        const expectedSize = document.getElementById('expected-size');
        if (expectedSize) {
          const pixelScale = getPixelSize();
          const expectedW = (40 * 6 * pixelScale) + 20;
          const expectedH = (20 * 8 * pixelScale) + 20;
          expectedSize.textContent = `${expectedW}√ó${expectedH}`;
        }
        
        // Device Type Detection
        const deviceType = document.getElementById('device-type');
        if (deviceType) {
          deviceType.textContent = getDeviceInfo().type;
        }
        
        // Scale Factor
        const scaleFactor = document.getElementById('scale-factor');
        if (scaleFactor) {
          const dpr = window.devicePixelRatio || 1;
          const scaleX = canvas.offsetWidth / canvas.width;
          const scaleY = canvas.offsetHeight / canvas.height;
          scaleFactor.textContent = `DPR:${dpr} Display:${scaleX.toFixed(2)}√ó${scaleY.toFixed(2)}`;
        }
        
        // Pixel Scale
        const pixelScaleEl = document.getElementById('pixel-scale');
        if (pixelScaleEl) {
          const pixelScale = getPixelSize();
          pixelScaleEl.textContent = `${pixelScale}√ó${pixelScale}`;
        }
        
        // System Version - simple/advanced renderer detection
        const systemVersion = document.getElementById('system-version');
        if (systemVersion) {
          const isAdvanced = (window.devicePixelRatio || 1) > 1;
          systemVersion.textContent = isAdvanced ? 'Advanced' : 'Simple';
          systemVersion.style.color = isAdvanced ? '#006600' : '#cc0000';
        }
        
        // Max Width/Height - remove these
        const maxWidth = document.getElementById('max-width');
        const maxHeight = document.getElementById('max-height');
        if (maxWidth) maxWidth.textContent = computedStyle.maxWidth;
        if (maxHeight) maxHeight.textContent = computedStyle.maxHeight;
      }
    }
    
    // Update resolution immediately and on resize
    updateResolutionInfo();
    window.addEventListener('resize', updateResolutionInfo);
    
    // Also update after a short delay to catch canvas initialization
    setTimeout(updateResolutionInfo, 2000);
  </script>

  <script>
    // Debug ES6 module loading
    window.addEventListener('error', function(e) {
      console.error('Script error:', e.error, e.filename, e.lineno);
      document.getElementById('status-msg').textContent = 'System Status: ‚úó Script Error - ' + e.message;
      document.getElementById('status-msg').style.color = '#cc0000';
    });
    
    console.log('About to load TRS-80 main module...');
  </script>

  <script src="js/boot.js"></script>
</body>
</html>