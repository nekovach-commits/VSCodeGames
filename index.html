<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="cache-bust" content="v2025-09-24-2">
  <title>TRS-80 Model 100 Emulator - Updated 2025-09-24</title>
  <link rel="stylesheet" href="style.css">
</head>
<body style="background: #ffffff !important; color: #000000 !important;">
  <div id="retro-container" tabindex="0" style="background: #ffffff !important;">
    <canvas id="retro-canvas" style="background: #ffffff !important; border: 3px solid #000000 !important; cursor: text;"></canvas>
    
    <!-- Kindle Keyboard Input -->
    <input type="text" id="kindle-input" placeholder="Tap here to open Kindle keyboard and type..." 
           style="width: 100%; max-width: 500px; padding: 10px; margin: 10px 0; font-family: 'Courier New', monospace; font-size: 16px; border: 2px solid #000; border-radius: 3px;">
    
    <div style="font-size: 12px; color: #666; margin-top: 10px; text-align: center;">
      ðŸ’¡ <strong>Kindle Users:</strong> Type in the input box above - text will appear on TRS-80 screen
    </div>
    
    <script>
      // Immediate canvas sizing - runs before modules load
      const canvas = document.getElementById('retro-canvas');
      const screenW = window.screen.width;
      const screenH = window.screen.height;
      console.log('Immediate sizing - Screen:', screenW + 'Ã—' + screenH);
      
      let pixelSize = 4; // Default
      if (screenW === 636 && screenH === 848) {
        pixelSize = 2; // Kindle ColorSoft
        console.log('âœ“ IMMEDIATE: Kindle ColorSoft detected');
      } else if (screenW <= 768) {
        pixelSize = 2; // Mobile
        console.log('âœ“ IMMEDIATE: Mobile detected');
      }
      
      const width = (40 * 6 * pixelSize) + 20;
      const height = (10 * 8 * pixelSize) + 20;
      
      canvas.width = width;
      canvas.height = height;
      console.log('âœ“ IMMEDIATE: Canvas set to', width + 'Ã—' + height);
      
      // Kindle Input Handler
      const kindleInput = document.getElementById('kindle-input');
      kindleInput.addEventListener('input', function(e) {
        const text = e.target.value;
        const lastChar = text.slice(-1);
        if (lastChar && window.trs80) {
          console.log('Kindle input:', lastChar);
          window.trs80.keyboard.processKeyInput(lastChar);
          window.trs80.display.render();
        }
      });
      
      kindleInput.addEventListener('keydown', function(e) {
        if (e.key === 'Backspace' && window.trs80) {
          console.log('Kindle backspace');
          window.trs80.keyboard.processKeyInput('Backspace');
          window.trs80.display.render();
          e.preventDefault();
        } else if (e.key === 'Enter' && window.trs80) {
          console.log('Kindle enter');
          window.trs80.keyboard.processKeyInput('Enter');
          window.trs80.display.render();
          e.target.value = ''; // Clear input
          e.preventDefault();
        }
      });
    </script>
    
    <div id="keyboard-area" style="background: #ffffff !important; color: #000000 !important;">
      <!-- Desktop Info -->
      <div id="desktop-info" style="margin-top: 15px; color: #000000 !important;">
        <p><strong>TRS-80 MODEL 100 - PORTABLE COMPUTER</strong></p>
        <p>Type anything â€¢ ENTER: new line â€¢ ESC: clear â€¢ BACKSPACE: delete â€¢ Arrow keys: navigate</p>
        <p>Resolution: <span id="resolution-info">Loading...</span></p>
        <div id="debug-info" style="margin-top: 10px; font-size: 10px; color: #666; font-family: monospace;">
          <div>Screen Resolution: <span id="screen-res">Loading...</span></div>
          <div>Canvas Size: <span id="canvas-size">Loading...</span></div>
          <div>Expected Size: <span id="expected-size">Loading...</span></div>
          <div>Device Type: <span id="device-type">Loading...</span></div>
          <div>Scale Factor: <span id="scale-factor">Loading...</span></div>
          <div>Pixel Scale: <span id="pixel-scale">Loading...</span></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function updateResolutionInfo() {
      const resolutionInfo = document.getElementById('resolution-info');
      
      if (resolutionInfo) {
        const info = [
          `${window.innerWidth}Ã—${window.innerHeight}`,
          `Screen: ${screen.width}Ã—${screen.height}`,
          `DPR: ${window.devicePixelRatio || 1}`,
          `Touch: ${'ontouchstart' in window ? 'Yes' : 'No'}`
        ].join(' â€¢ ');
        resolutionInfo.textContent = info;
      }
      
      // Update individual debug fields
      const canvas = document.getElementById('retro-canvas');
      if (canvas) {
        const computedStyle = window.getComputedStyle(canvas);
        
        // Screen Resolution
        const screenRes = document.getElementById('screen-res');
        if (screenRes) screenRes.textContent = `${screen.width}Ã—${screen.height}`;
        
        // Canvas Size
        const canvasSize = document.getElementById('canvas-size');
        if (canvasSize) canvasSize.textContent = `${canvas.width}Ã—${canvas.height}`;
        
        // Expected Size (for Kindle: 40Ã—6Ã—2 + 20 = 500Ã—180)
        const expectedSize = document.getElementById('expected-size');
        if (expectedSize) {
          const width = screen.width;
          const height = screen.height;
          let pixelScale = 4; // Default
          if (width === 636 && height === 848) pixelScale = 2; // Kindle
          else if (width <= 768) pixelScale = 2; // Mobile
          
          const expectedW = (40 * 6 * pixelScale) + 20;
          const expectedH = (10 * 8 * pixelScale) + 20;
          expectedSize.textContent = `${expectedW}Ã—${expectedH}`;
        }
        
        // Device Type Detection
        const deviceType = document.getElementById('device-type');
        if (deviceType) {
          let type = 'Unknown';
          const width = screen.width;
          const height = screen.height;
          if (width === 636 && height === 848) {
            type = 'Kindle ColorSoft';
          } else if (width <= 768) {
            type = 'Mobile';
          } else if (width <= 1024) {
            type = 'Tablet';
          } else {
            type = 'Desktop';
          }
          deviceType.textContent = type;
        }
        
        // Scale Factor
        const scaleFactor = document.getElementById('scale-factor');
        if (scaleFactor) {
          const dpr = window.devicePixelRatio || 1;
          const scaleX = canvas.offsetWidth / canvas.width;
          const scaleY = canvas.offsetHeight / canvas.height;
          scaleFactor.textContent = `DPR:${dpr} Display:${scaleX.toFixed(2)}Ã—${scaleY.toFixed(2)}`;
        }
        
        // Pixel Scale
        const pixelScaleEl = document.getElementById('pixel-scale');
        if (pixelScaleEl) {
          const width = screen.width;
          const height = screen.height;
          let pixelScale = 4;
          if (width === 636 && height === 848) pixelScale = 2;
          else if (width <= 768) pixelScale = 2;
          pixelScaleEl.textContent = `${pixelScale}Ã—${pixelScale}`;
        }
        
        // Max Width/Height - remove these
        const maxWidth = document.getElementById('max-width');
        const maxHeight = document.getElementById('max-height');
        if (maxWidth) maxWidth.textContent = computedStyle.maxWidth;
        if (maxHeight) maxHeight.textContent = computedStyle.maxHeight;
      }
    }
    
    // Update resolution immediately and on resize
    updateResolutionInfo();
    window.addEventListener('resize', updateResolutionInfo);
    
    // Also update after a short delay to catch canvas initialization
    setTimeout(updateResolutionInfo, 2000);
  </script>

  <script type="module" src="js/trs80-main.js"></script>
</body>
</html>